<h2 mat-dialog-title>
  <mat-icon>{{ data.mode === 'create' ? 'add' : 'edit' }}</mat-icon>
  {{ data.mode === 'create' ? 'Add New Product' : 'Edit Product' }}
</h2>

<mat-dialog-content>
  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
    
    <!-- Basic Information -->
    <div class="form-section">
      <h3 class="section-title">
        <mat-icon>info</mat-icon>
        Basic Information
      </h3>
      
      <div class="form-row">
        <!-- Product Name -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Product Name</mat-label>
          <mat-icon matPrefix>inventory</mat-icon>
          <input matInput formControlName="name" placeholder="Enter product name">
          
          <mat-error *ngIf="productForm.get('name')?.hasError('required')">
            Product name is required
          </mat-error>
          <mat-error *ngIf="productForm.get('name')?.hasError('minlength')">
            Product name must be at least 3 characters
          </mat-error>
          <mat-error *ngIf="productForm.get('name')?.hasError('maxlength')">
            Product name must be less than 100 characters
          </mat-error>
        </mat-form-field>

        <!-- SKU -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>SKU</mat-label>
          <mat-icon matPrefix>qr_code</mat-icon>
          <input matInput formControlName="sku" placeholder="Enter SKU">
          
          <mat-error *ngIf="productForm.get('sku')?.hasError('required')">
            SKU is required
          </mat-error>
          <mat-error *ngIf="productForm.get('sku')?.hasError('pattern')">
            SKU must be alphanumeric with hyphens or underscores
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Description -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <mat-icon matPrefix>description</mat-icon>
        <textarea matInput formControlName="description" rows="3" placeholder="Enter product description"></textarea>
        
        <mat-error *ngIf="productForm.get('description')?.hasError('required')">
          Description is required
        </mat-error>
        <mat-error *ngIf="productForm.get('description')?.hasError('minlength')">
          Description must be at least 10 characters
        </mat-error>
        <mat-error *ngIf="productForm.get('description')?.hasError('maxlength')">
          Description must be less than 500 characters
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Pricing & Inventory -->
    <div class="form-section">
      <h3 class="section-title">
        <mat-icon>monetization_on</mat-icon>
        Pricing & Inventory
      </h3>
      
      <div class="form-row">
        <!-- Price -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Price</mat-label>
          <mat-icon matPrefix>attach_money</mat-icon>
          <input matInput type="number" formControlName="price" placeholder="0.00" step="0.01" min="0">
          
          <mat-error *ngIf="productForm.get('price')?.hasError('required')">
            Price is required
          </mat-error>
          <mat-error *ngIf="productForm.get('price')?.hasError('min')">
            Price must be greater than 0
          </mat-error>
        </mat-form-field>

        <!-- Quantity -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Quantity</mat-label>
          <mat-icon matPrefix>numbers</mat-icon>
          <input matInput type="number" formControlName="quantity" placeholder="0" step="1" min="0">
          
          <mat-error *ngIf="productForm.get('quantity')?.hasError('required')">
            Quantity is required
          </mat-error>
          <mat-error *ngIf="productForm.get('quantity')?.hasError('min')">
            Quantity cannot be negative
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <!-- Category -->
    <div class="form-section">
      <h3 class="section-title">
        <mat-icon>category</mat-icon>
        Category
      </h3>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Category</mat-label>
        <mat-icon matPrefix>label</mat-icon>
        <mat-select formControlName="categoryId">
          <mat-option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
            <span class="category-description">{{ category.description }}</span>
          </mat-option>
        </mat-select>
        
        <mat-error *ngIf="productForm.get('categoryId')?.hasError('required')">
          Category is required
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Image URL -->
    <div class="form-section">
      <h3 class="section-title">
        <mat-icon>image</mat-icon>
        Product Image
      </h3>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Image URL</mat-label>
        <mat-icon matPrefix>link</mat-icon>
        <input matInput formControlName="imageUrl" placeholder="https://example.com/image.jpg">
        
        <mat-error *ngIf="productForm.get('imageUrl')?.hasError('pattern')">
          Please enter a valid URL
        </mat-error>
      </mat-form-field>
      
      <!-- Image Preview -->
      <div class="image-preview" *ngIf="productForm.get('imageUrl')?.value">
        <img [src]="productForm.get('imageUrl')?.value" alt="Product Preview" (error)="onImageError($event)">
        <p class="image-hint">Image Preview</p>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancel</button>
  
  <button mat-raised-button color="primary" 
          (click)="onSubmit()" 
          [disabled]="productForm.invalid || isLoading"
          class="submit-button">
    <span *ngIf="!isLoading">
      <mat-icon>{{ data.mode === 'create' ? 'add' : 'save' }}</mat-icon>
      {{ data.mode === 'create' ? 'Create Product' : 'Update Product' }}
    </span>
    <span *ngIf="isLoading">
      <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
      {{ data.mode === 'create' ? 'Creating...' : 'Updating...' }}
    </span>
  </button>
</mat-dialog-actions>